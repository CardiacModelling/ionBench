# Uncertainty
## Summary
This directory contains the [profile likelihood code](../../ionbench/uncertainty/profile_likelihood.py) to analyse the benchmark problems and derive cost thresholds.

## Usage
The [profile likelihood code](../../ionbench/uncertainty/profile_likelihood.py) contains two functions:
1. `run()` - This function runs the profile likelihood analysis on the benchmark problems and saves the results to a file.
2. `plot_profile_likelihood()` - This function plots the results of the profile likelihood analysis from a saved file.

When generating the profile likelihoods, we build a `ProfileManager` object. This acts as an interface to allow the standard ***ionBench*** optimisers to be run, while also restricting one of the parameters to a fixed value. The optimiser used to generate the profile likelihoods is TRR, although this is optional.

The profile likelihoods are generated by perturbing the parameters to each of the points in `variations` and optimising them. The previously optimised parameters are used as the starting location for the next parameter variation. For example:
1. The first parameter is fixed to its optimal value, multiplied by `variations[0][0]`.
2. Optimisation is begun, with the other parameters free to vary, starting from their true values.
3. The cost is recorded.
4. The first parameter is fixed to its optimal value, multiplied by `variations[0][1]`.
5. Optimisation is begun, with the other parameters free to vary, starting the previous optimisation output.
6. The cost is recorded.
7. Repeat for all variations of the first parameter.
8. Repeat for all parameters.

Sometimes the profile likelihood plots can have problems, so we also allow you to generate them backwards. We still start with the first parameter (the order of the parameters doesn't affect anything), but begin the profile likelihood generation at `variations[i][-1]` and work backwards to `variations[i][0]`.

The results are saved to a file, which can be plotted using the `plot_profile_likelihood()` function.

The `plot_profile_likelihood()` function reads the results from the file and plots them. It automatically checks for backwards profile likelihoods and plots the minimum of the two (with a debug option to view them both separately). The plotting also prints the cost threshold calculated from the profile likelihood plots.
